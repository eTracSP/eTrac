@{
    long locationId = 0;
    long userId = 0;
    long userType = 0;
    long isAllLocation = 0;
    WorkOrderEMS.Models.eTracLoginModel ObjLogin = new WorkOrderEMS.Models.eTracLoginModel();
    ObjLogin = (WorkOrderEMS.Models.eTracLoginModel)Session["eTrac"];
    if (ObjLogin != null)
    {
        locationId = ObjLogin.LocationID;
        userId = ObjLogin.UserId;
        userType = ObjLogin.UserRoleId;

        if (Session["eTrac_SelectedDasboardLocationID"] != null)
        {
            if (Convert.ToInt64(Session["eTrac_SelectedDasboardLocationID"]) != 0)
            {
                isAllLocation = ObjLogin.LocationID;
            }
        }
    }
}

<div id="pushNotificationForWorkOrder" class="alert alert-info">
    <a href="javascript:void(0)" class="close" onclick="return closeRightCornerPopUP(this)" id="rightCornerClass">&times;</a>
    <strong>New Work Order Submitted</strong> <p id="messageForPushNotifi">.</p>
</div>
<div id="pushNotificationForSafetyWorkOrder" class="alert alert-danger">
    <a href="javascript:void(0)" class="close" onclick="return closeRightCornerPopUP(this)" id="rightCornerClass">&times;</a>
    <strong>New Safety Hazard Work Order Submitted</strong> <p id="messageForSafetyPushNotifi">.</p>
</div>
<!--Moment Javascript-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script src="@Url.Content("~/Scripts/moment-timezone-with-data.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.signalR-2.2.0.min.js")"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="@Url.Content("~/signalr/hubs")"></script>
<script src="@Url.Content("~/Scripts/iwc-all.min.js")"></script>
<script src="@Url.Content("~/Scripts/signalr-patch.js")"></script>
<script src="@Url.Content("~/Scripts/iwc-signalr.js")"></script>

<script type="text/javascript">
    var LocationId = '@locationId';
    var UserId = '@userId';
    var UserType = '@userType';
    var IsAllLocation = '@isAllLocation';

    @*if (UserType != parseInt(4)) {
        function CheckQrcExpirationDate() {
            $.ajax({
                type: "GET",
                url: '@Url.Action("SendQrcExpirationMail", "Manager")',
                //url: $_HostPrefix + 'Manager/SendQrcExpirationMail',
                async: false,
                data: { "id": $("#drp_MasterLocation").val() },
                success: function (Data) {
                    if (Data.status != null && Data.status != "" && Data.status == true) {
                        clearInterval(refreshIntervalId);
                    }
                },
                error: function (err) {
                    console.log(err);
                }

            });//ajax end block for CheckQrcExpirationDate
        }
        //Created for Notification alert to manager whenever new work order,infraction,Employee idle status created
        var refreshIntervalId = null;
        refreshIntervalId = setInterval(CheckQrcExpirationDate, 15000);
    }*@

    $(function () {
        getAllDashboardData();

        var echoHub = SJ.iwc.SignalR.getHubProxy('notificationAlertHub', {
            client: {
                updateMessages: function () {
                    
                    try {
                        //For to show the work order alert
                        getAllWorkOrder()
                        if (IsAllLocation == 0 || IsAllLocation == 0) {
                            LocationId = 0;
                        }
                        var date = new Date();
                        var todaysDate = (date.toLocaleString("en-us", { month: "long" }) + ' ' + date.getDate() + ', ' + date.getFullYear());
                        var filterdate = $('#reservation1').val();

                        if (filterdate != null && filterdate != undefined && filterdate != '') {
                            if (filterdate == (todaysDate + ' - ' + todaysDate) || $.trim(filterdate.split('-')[1]) == todaysDate) {
                                echoHub.server.getWorkOrderForDashboardSignalR(LocationId, UserId, $.trim(filterdate.split('-')[0]), $.trim(filterdate.split('-')[1]), UserType).done(function (dataItems) {
                                    
                                    if (dataItems != null && dataItems != "") {
                                        dataJSON = JSON.parse(dataItems);

                                        if ($("#divWOProgress #dtWOProgress").length > 0) {

                                            $('#dtWOProgress').dataTable().fnDestroy();
                                            $('#dtWOProgress').remove();
                                            //***********************WO Progress data table*******************************//
                                            var WOProgressBody = '';
                                            WOProgressBody = "<table id='dtWOProgress' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:13%'>Location</th><th style='width:10%;'>Project Type</th><th style='width:12%;'>Priority</th><th style='width:20%;'>Assign To</th><th style='width:14%;'>Created On</th><th style='width:17%;'>Progress</th></tr></thead><tbody id='dtWOProgressbody'>";
                                            if (dataJSON.Progress.length > 0) {
                                                
                                                for (i = 0; (i < dataJSON.Progress.length); i++) {
                                                    var ProgressTD = '';
                                                    var progress = dataJSON.Progress[i]['ProgressBar'];
                                                    if (progress != 296 && progress != 295) {
                                                        var progbar = progress
                                                    }
                                                    if (dataJSON.Progress[i]['PauseStatus'] == 330 || dataJSON.Progress[i]['PauseStatus'] == null) {
                                                        switch (parseInt(progress)) {
                                                            case (296):
                                                                ProgressTD = '<td><div class="text-red">Over Limit</div></td>';
                                                                break;
                                                            case (295):
                                                                ProgressTD = '<td><div class="text-green">No Limit</div></td>';
                                                                break;
                                                            case (progbar):

                                                                if (progress > 75 && progress < 90) {
                                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color2" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div> <div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                                }
                                                                else if (progress > 90 && progress <= 99) {
                                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color3" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div><div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                                }
                                                                else if (true) {
                                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div><div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                                }

                                                                break;
                                                            default:
                                                                ProgressTD = '<td><div class="text-yellow">Not-Assigned</div></td>';
                                                                break
                                                        }
                                                    }
                                                    else {
                                                        ProgressTD = '<td><div class="text-green">Pause</div></td>';
                                                    }
                                                    //var now = getStatusTime();
                                                    WOProgressBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Progress[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Progress[i]['CodeID'] + '</td> <td>' + dataJSON.Progress[i]['LocationName'] + '</td><td>' + dataJSON.Progress[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Progress[i]['PriorityColor'] + '">' + dataJSON.Progress[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Progress[i]['AssignToUserName'] + '</td><td>' + dataJSON.Progress[i]['CreatedDate'] + '</td>' + ProgressTD + '</tr>';
                                                }
                                                WOProgressBody += "</tbody></table>";
                                            }
                                            $('#divWOProgress').html(WOProgressBody);
                                            $("#dtWOProgress").DataTable({
                                                "order": [[0, "desc"]]
                                            });
                                            updateProgressTime();
                                            //*******************WO Progress data table End*******************************//

                                        }
                                        if ($("#divWOPending #dtWOPending").length > 0) {
                                            $('#dtWOPending').dataTable().fnDestroy();
                                            $('#dtWOPending').remove();
                                            //*******************WO Pending data table*******************************//
                                            var WOPendingBody = '';
                                            WOPendingBody = "<table id='dtWOPending' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:17%;'>Location</th><th style='width:18%;'>Project Type</th><th style='width:15%;'>Priority</th><th style='width:20%;'>Assign To</th><th style='width:16%;'>Created On</th></tr></thead><tbody id='dtWOPendingbody'>";
                                            if (dataJSON.Pending.length > 0) {
                                                for (i = 0; (i < dataJSON.Pending.length); i++) {
                                                    WOPendingBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Pending[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Pending[i]['CodeID'] + '</td> <td>' + dataJSON.Pending[i]['LocationName'] + '</td><td>' + dataJSON.Pending[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Pending[i]['PriorityColor'] + '">' + dataJSON.Pending[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Pending[i]['AssignToUserName'] + '</td><td>' + dataJSON.Pending[i]['CreatedDate'] + '</td></tr>';
                                                }
                                                WOPendingBody += "</tbody></table>";
                                            }
                                            $('#divWOPending').html(WOPendingBody);
                                            $("#dtWOPending").DataTable({
                                                "order": [[0, "desc"]]
                                            });
                                            //*******************WO Pending data table End*******************************//
                                        }
                                        if ($("#divWOComplete #dtWOComplete").length > 0) {
                                            $('#dtWOComplete').dataTable().fnDestroy();
                                            $('#dtWOComplete').remove();
                                            //*******************WO Completed data table*******************************//
                                            var WOCompleteBody = '';
                                            WOCompleteBody = "<table id='dtWOComplete' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:17%;'>Location</th><th style='width:15%;'>Priority</th><th style='width:20%;'>Completed By</th><th style='width:16%;'>Created On</th><th style='width:18%;'>Completed On</th></tr></thead><tbody id='dtWOCompletebody'>";
                                            if (dataJSON.Completed.length > 0) {
                                                for (i = 0; (i < dataJSON.Completed.length); i++) {
                                                    WOCompleteBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Completed[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Completed[i]['CodeID'] + '</td> <td>' + dataJSON.Completed[i]['LocationName'] + '</td><td><span class="' + dataJSON.Completed[i]['PriorityColor'] + '">' + dataJSON.Completed[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Completed[i]['AssignToUserName'] + '</td><td>' + dataJSON.Completed[i]['CreatedDate'] + '</td><td>' + dataJSON.Completed[i]['EndTimeFull'] + '</td></tr>';
                                                }
                                                WOCompleteBody += "</tbody></table>";
                                            }
                                            $('#divWOComplete').html(WOCompleteBody);
                                            $("#dtWOComplete").DataTable({
                                                "order": [[0, "desc"]]
                                            });
                                            //*******************WO Completed data table End*******************************//
                                        }

                                        //*******************UnAssigned WO Section*******************************//
                                        var UnAssignedWOBody = '';
                                        $('#divUnAssignedWODetails #UnAssignedDetails').append('');

                                        //This condition for client created WO on top of the list
                                        if (parseInt(UserType) == parseInt(2) || parseInt(UserType) == parseInt(6)) {
                                            if (dataJSON.UnAssignedWOClientCreated.length > 0) {
                                                for (i = 0; (i < dataJSON.UnAssignedWOClientCreated.length); i++) {
                                                    UnAssignedWOBody += '<tr id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + ' class="ClientCreatedWO"><td> <strong>' + dataJSON.UnAssignedWOClientCreated[i]['CodeID'] + '</strong><br>' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevelName'] + '<br>' + dataJSON.UnAssignedWOClientCreated[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestProjectTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevelName'] + '</td><td style="display:none;"><img style="height: 150px !important;width: 150px !important;" src=' + $_HostPrefix + 'Content/Images/WorkRequest/' + dataJSON.UnAssignedWOClientCreated[i]['AssignedWorkOrderImage'] + '></td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestStatusName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['CreatedDate'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['CodeID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['LocationName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['LocationID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevel'] + '</td><td class="vertibalM" align="center"><a class="editBtn assign" id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + '><i class="fa fa-pencil"></i></a> <a class="editBtn view" id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + '><i class="fa fa-eye"></i></a></td></tr>';
                                                }
                                            }
                                        }
                                        if (dataJSON.UnAssignedWO.length > 0) {
                                            for (i = 0; (i < dataJSON.UnAssignedWO.length); i++) {
                                                UnAssignedWOBody += '<tr id=' + dataJSON.UnAssignedWO[i]['ID'] + '><td> <strong>' + dataJSON.UnAssignedWO[i]['CodeID'] + '</strong><br>' + dataJSON.UnAssignedWO[i]['PriorityLevelName'] + '<br>' + dataJSON.UnAssignedWO[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestProjectTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['PriorityLevelName'] + '</td><td style="display:none;"><img style="height: 150px !important;width: 150px !important;" src=' + $_HostPrefix + 'Content/Images/WorkRequest/' + dataJSON.UnAssignedWO[i]['AssignedWorkOrderImage'] + '></td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestStatusName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['CreatedDate'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['CodeID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['LocationName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['LocationID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['PriorityLevel'] + '</td><td class="vertibalM" align="center"><a class="editBtn assign" id=' + dataJSON.UnAssignedWO[i]['ID'] + '><i class="fa fa-pencil"></i></a> <a class="editBtn view" id=' + dataJSON.UnAssignedWO[i]['ID'] + '><i class="fa fa-eye"></i></a></td></tr>';
                                            }
                                        }
                                        $('#divUnAssignedWODetails #UnAssignedDetails').html(UnAssignedWOBody);
                                        var dynamicScript = "<script type='text/javascript'>$('#divUnAssignedWODetails #UnAssignedDetails .view').click(function () { var row = $(this).closest('tr'); var id = $(this).attr('id'); var WorkRequestProjectTypeName = row.find('td').eq(1).html(); var WorkRequestTypeName = row.find('td').eq(2).html(); var PriorityLevelName = row.find('td').eq(3).html(); var AssignedWorkOrderImage = row.find('td').eq(4).html(); var WorkRequestStatusName = row.find('td').eq(5).html(); var Submittedon = row.find('td').eq(6).html(); var ProblemDesc = row.find('td').eq(7).html(); var CodeId = row.find('td').eq(8).html(); var LocationName = row.find('td').eq(9).html(); $('#lblProjectType').html(WorkRequestProjectTypeName); $('#lblWorkRequestType').html(WorkRequestTypeName); $('#lblAssignedWorkImage').html(AssignedWorkOrderImage); $('#lblPriorityLevel').html(PriorityLevelName); $('#lblWorkRequestStatus').html(WorkRequestStatusName); $('#lblSubmittedOn').html(Submittedon); if (ProblemDesc == null || ProblemDesc == '') { $('#labellProblemDescription').hide(); $('#lblProblemDescription').hide(); } else { $('#lblProblemDescription').html(ProblemDesc); $('#labellProblemDescription').show(); $('#lblProblemDescription').show(); } $('#lblCodeNo').html(CodeId); $('#lblLocationName').html(LocationName);if(WorkRequestProjectTypeName == 'Special Project'){$('#labelWorkRequestType').hide();$('#lblWorkRequestType').hide()}else{$('#labelWorkRequestType').show();$('#lblWorkRequestType').show()}$('.modal-title').text('Work Order Details'); $('#ModalDetailPreview').modal('show'); }); $('#divUnAssignedWODetails #UnAssignedDetails .assign').click(function () { var row = $(this).closest('tr'); var id = $(this).attr('id'); var ProblemDesc = row.find('td').eq(7).html(); var PriorityLevel = row.find('td').eq(11).html(); var ProjectDesc = row.find('td').eq(7).html(); var locationId = row.find('td').eq(10).html(); var WorkRequestType = row.find('td').eq(1).html(); if (PriorityLevel == null || PriorityLevel == '' || PriorityLevel == 'undefined') { PriorityLevel = 0; } $.ajax({ type: 'GET', data: { 'id': id, 'ProblemDesc': ProblemDesc, 'PriorityLevel': PriorityLevel, 'ProjectDesc': ProjectDesc, 'WorkRequestType': WorkRequestType, 'locationId': locationId }, url: '" + $_HostPrefix + "GlobalAdmin/_AssignWorkAssignmentRequest/', contentType: 'application/json; charset=utf-8', error: function (xhr, status, error) { }, success: function (result) { $('.modal-title').text('Assign Work Order'); $('#largeeditpopup').html(result); $('#myModallarge').modal('show'); } }); });<\/script>";
                                        $('#divUnAssignedWODetails').append(dynamicScript);
                                        //*******************UnAssigned WO Section End*******************************//
                                        //******************* Work Request Count *******************************//
                                        $('#divCountPanel #WorkRequestCount').text(dataJSON.CountPanel[0]['WorkRequestCount']);

                                        //******************* Work Order Pie Chart ***********************************//
                                        if (dataJSON.WorkProjectType.length > 0 || dataJSON.WorkStatus.length > 0) {
                                            var arrData = [];
                                            if (dataJSON.WorkStatus.length > 0) {
                                                for (i = 0; i < dataJSON.WorkStatus.length; i++) {
                                                    arrData.push({
                                                        title: dataJSON.WorkStatus[i].Title,
                                                        value: parseInt(dataJSON.WorkStatus[i].Value)
                                                    });
                                                }
                                            }

                                            if (dataJSON.WorkProjectType.length > 0) {
                                                for (i = 0; i < dataJSON.WorkProjectType.length; i++) {

                                                    if (dataJSON.WorkProjectType[i].Title == 'Continuous Request')
                                                        dataJSON.WorkProjectType[i].Title = 'CR';
                                                    if (dataJSON.WorkProjectType[i].Title == 'Facility Request')
                                                        dataJSON.WorkProjectType[i].Title = 'FR';
                                                    if (dataJSON.WorkProjectType[i].Title == 'Special Project')
                                                        dataJSON.WorkProjectType[i].Title = 'SP';
                                                    if (dataJSON.WorkProjectType[i].Title == 'Work Request')
                                                        dataJSON.WorkProjectType[i].Title = 'WR';
                                                    arrData.push({
                                                        title: dataJSON.WorkProjectType[i].Title,
                                                        value: parseInt(dataJSON.WorkProjectType[i].Value)
                                                    });
                                                }
                                            }
                                            var chart = AmCharts.makeChart("workOrderChart", {
                                                "type": "pie",
                                                "theme": "light",
                                                "radius": "20%",
                                                "innerRadius": "45%",
                                                "gradientRatio": [-0.4, -0.4, -0.4, -0.4, -0.4, -0.4, 0, 0.1, 0.2, 0.1, 0, -0.2, -0.5],
                                                "dataProvider": arrData,
                                                "labelText": "[[title]]",
                                                "balloonText": "[[value]]",
                                                "valueField": "value",
                                                "titleField": "title",
                                                "balloon": {
                                                    "drop": true,
                                                    "adjustBorderColor": false,
                                                    "color": "#FFFFFF",
                                                    "fontSize": 16
                                                },
                                                "export": {
                                                    "enabled": true
                                                }
                                            });
                                            var title;
                                            var html;
                                            // populate our custom legend when chart renders
                                            if (chart.dataProvider.length > 0) {
                                                $('#legend').html('');
                                                html = '<div class="legend-item"><ul>';
                                                // populate our custom legend when chart renders
                                                // chart.customLegend = document.getElementById('legend');
                                                for (var i in chart.dataProvider) {
                                                    var row = chart.dataProvider[i];
                                                    if (row.title == 'CR')
                                                        title = 'CR-Continuous Request';
                                                    if (row.title == 'FR')
                                                        title = 'FR-Facility Request';
                                                    if (row.title == 'SP')
                                                        title = 'SP-Special Project';
                                                    if (row.title == 'WR')
                                                        title = 'WR-Work Request';
                                                    if (row.title == 'Complete')
                                                        title = 'Complete';
                                                    if (row.title == 'In Progress')
                                                        title = 'In Progress';
                                                    if (row.title == 'Pending')
                                                        title = 'Pending';
                                                    // var title = row.title;
                                                    var color = chart.colors[i];
                                                    var value = row.value;
                                                    html += '<li><div class="legend-marker" style="background: ' + color + '"></div>' + title + '<span>' + value + '</span></li>';

                                                }
                                                html += '</ul></div>';
                                                $('#legend').append(html);
                                            }
                                        }
                                        else {
                                            $('#workOrderChart').html('');
                                            $('#legend').html('No Work Order generated for a day');
                                        }
                                        //******************* Work Order Pie Chart End *******************************//

                                        //*******************DAR Marquee*******************************//
                                        var DARBody = '';
                                        $('#divDarDetails #darDetail').append('');
                                        if (dataJSON.DarDetail.length > 0) {
                                            for (i = 0; (i < dataJSON.DarDetail.length); i++) {
                                                DARBody += '<tr><td><div class="zoomin"><img src=' + $_HostPrefix + 'Content/Images/ProfilePic/' + dataJSON.DarDetail[i]['ProfileImage'] + '></div> <div class="dailyActRp"><strong>' + dataJSON.DarDetail[i]['TaskType'] + '</strong><br>' + dataJSON.DarDetail[i]['ActivityDetails'] + '</div></td></tr>';
                                            }
                                        }
                                        $('#divDarDetails #darDetail').html(DARBody);
                                        //*******************DAR Marquee End*******************************//

                                    }
                                })
                            }
                        }
                    }
                    catch (e) { console.log(e); }
                }
            }
        });
     
        SJ.iwc.SignalR.start().done(function () {
            console.log('started');
            getAllWorkOrder();
        });
        //************************* Use Less Script but having dynamic loaded thats why for backup**************************//
        $("#divUnAssignedWODetails #UnAssignedDetails .view").click(function () {

            var row = $(this).closest("tr");
            var id = $(this).attr("id");
            var WorkRequestProjectTypeName = row.find("td").eq(1).html();
            var WorkRequestTypeName = row.find("td").eq(2).html();
            var PriorityLevelName = row.find("td").eq(3).html();
            var AssignedWorkOrderImage = row.find("td").eq(4).html();
            var WorkRequestStatusName = row.find("td").eq(5).html();
            var Submittedon = row.find("td").eq(6).html();
            var ProblemDesc = row.find("td").eq(7).html();
            var CodeId = row.find("td").eq(8).html();
            var LocationName = row.find("td").eq(9).html();

            $("#lblProjectType").html(WorkRequestProjectTypeName);
            $("#lblWorkRequestType").html(WorkRequestTypeName);

            $("#lblAssignedWorkImage").html(AssignedWorkOrderImage);
            $("#lblPriorityLevel").html(PriorityLevelName);
            $("#lblWorkRequestStatus").html(WorkRequestStatusName);
            $("#lblSubmittedOn").html(Submittedon);
            if (ProblemDesc == null || ProblemDesc == "") {
                $("#labellProblemDescription").hide();
                $("#lblProblemDescription").hide();
            }
            else {
                $("#lblProblemDescription").html(ProblemDesc);
                $("#labellProblemDescription").show();
                $("#lblProblemDescription").show();
            }
            $("#lblCodeNo").html(CodeId);

            $("#lblLocationName").html(LocationName);
            $('.modal-title').text("Work Order Details");
            $("#ModalDetailPreview").modal('show');

        });
        $("#divUnAssignedWODetails #UnAssignedDetails .assign").click(function () {
            var row = $(this).closest("tr");
            var id = $(this).attr("id");
            var ProblemDesc = row.find("td").eq(7).html();
            var PriorityLevel = row.find("td").eq(11).html();
            var ProjectDesc = row.find("td").eq(7).html();
            var locationId = row.find("td").eq(10).html();
            var WorkRequestType = row.find("td").eq(1).html();
            if (PriorityLevel == null || PriorityLevel == "" || PriorityLevel == 'undefined') {
                PriorityLevel = 0;
            }

            $.ajax({
                type: "GET",
                data: { 'id': id, 'ProblemDesc': ProblemDesc, 'PriorityLevel': PriorityLevel, 'ProjectDesc': ProjectDesc, 'WorkRequestType': WorkRequestType, 'locationId': locationId },
                url: '../GlobalAdmin/_AssignWorkAssignmentRequest/',
                contentType: "application/json; charset=utf-8",
                error: function (xhr, status, error) {
                },
                success: function (result) {

                    $('.modal-title').text("Assign Work Order");
                    $("#largeeditpopup").html(result);
                    $("#myModallarge").modal('show');
                }
            });
        });
        //************************* Use Less Script but having dynamic loaded thats why for backup**************************//
    });

    function getAllDashboardData(isInterval) {
        try {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetDashboardHeadCount", "GlobalAdmin")',
                // url: $_HostPrefix + '/GlobalAdmin/GetDashboardHeadCount',
                async: true,
                data: {},
            }).success(function (dataItems) {

                if (dataItems.dataJson != null && dataItems.dataJson != "" && dataItems.dataJson.trim() != "") {

                    dataJSON = JSON.parse(dataItems.dataJson);
                      
                    //*******************Count panel*******************************//
                    $('#divCountPanel #QrcCount').text(dataJSON.CountPanel[0]['QrcCount']);
                    $('#divCountPanel #WorkRequestCount').text(dataJSON.CountPanel[0]['WorkRequestCount']);
                    $('#divCountPanel #UserCount').text(dataJSON.CountPanel[0]['UserCount']);
                    $('#divCountPanel #VendorsVehicleCount').text(dataJSON.CountPanel[0]['VendorsVehicleCount']);
                    $('#divPieUserGraph #pieEmpCount').data('percent', (dataJSON.CountPanel[0]['EmpCount']));

                    $('#divPieUserGraph #EmpCount').html(dataJSON.CountPanel[0]['EmpCount']);
                    $('#divPieUserGraph #AdminCount').html(dataJSON.CountPanel[0]['AdminCount']);
                    $('#divPieUserGraph #ManagerCount').html(dataJSON.CountPanel[0]['ManagerCount']);
                    $('#divPieUserGraph #ClientCount').html(dataJSON.CountPanel[0]['ClientCount']);
                    $('#diveCashAndInfraction #eCash').text('$' + dataJSON.CountPanel[0]['eCash']);
                    $('#diveCashAndInfraction #eCashLastAmt').text('$' + dataJSON.CountPanel[0]['eCashLastAmt']);
                    $('#diveCashAndInfraction #PaidBy').text(dataJSON.CountPanel[0]['PaidBy']);
                    $('#diveCashAndInfraction #AcceptedBy').text(dataJSON.CountPanel[0]['AcceptedBy']);
                    $('#diveCashAndInfraction #InfractionCount').text(dataJSON.CountPanel[0]['InfractionCount']);
                    $('#diveCashAndInfraction #Declined').text(dataJSON.CountPanel[0]['Declined']);
                    $('#diveCashAndInfraction #Approved').text(dataJSON.CountPanel[0]['Approved']);
                    $('#divScannedByPanel #PhoneSystems').text(dataJSON.CountPanel[0]['PhoneSystems']);
                    $('#divScannedByPanel #Devices').text(dataJSON.CountPanel[0]['Devices']);
                    $('#divScannedByPanel #TrashCan').text(dataJSON.CountPanel[0]['TrashCan']);
                    $('#divScannedByPanel #Elevator').text(dataJSON.CountPanel[0]['Elevator']);
                    $('#divScannedByPanel #Equipment').text(dataJSON.CountPanel[0]['Equipment']);
                    $('#divScannedByPanel #TicketSpitter').text(dataJSON.CountPanel[0]['TicketSpitter']);
                    $('#divScannedByPanel #Vehicle').text(dataJSON.CountPanel[0]['Vehicle']);
                    $('#divScannedByPanel #BusStation').text(dataJSON.CountPanel[0]['BusStation']);
                    $('#divScannedByPanel #MovingWalkway').text(dataJSON.CountPanel[0]['MovingWalkway']);
                    $('#divScannedByPanel #Escalators').text(dataJSON.CountPanel[0]['Escalators']);
                    $('#divScannedByPanel #Bathroom').text(dataJSON.CountPanel[0]['Bathroom']);
                    $('#divScannedByPanel #ParkingFacility').text(dataJSON.CountPanel[0]['ParkingFacility']);
                    $('#divScannedByPanel #ShuttleBus').text(dataJSON.CountPanel[0]['ShuttleBus']);
                    $('#divScannedByPanel #GateArm').text(dataJSON.CountPanel[0]['GateArm']);
                    //This condition for when interval hit we need to clear data table.
                    if (isInterval) {
                        $('#dtWOProgress').dataTable().fnDestroy();
                        $('#dtWOProgress').remove();
                        //*******************WO Progress data table*******************************//
                        var WOProgressBody = '';
                        WOProgressBody = "<table id='dtWOProgress' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:10%;'>Location<th style='width:10%;'>Project Type</th><th style='width:12%;'>Priority</th><th style='width:20%;'>Assign To</th><th style='width:14%;'>Created On</th><th style='width:17%;'>Progress</th></tr></thead><tbody id='dtWOProgressbody'>";
                        if (dataJSON.Progress.length > 0) {
                            
                            for (i = 0; (i < dataJSON.Progress.length) ; i++) {
                                var ProgressTD = '';
                                var progress = dataJSON.Progress[i]['ProgressBar'];
                                if (progress != 296 && progress != 295) {
                                    var progbar = progress
                                } if (dataJSON.Progress[i]['PauseStatus'] == 330 || dataJSON.Progress[i]['PauseStatus'] == null) {
                                    switch (parseInt(progress)) {
                                        case (296):
                                            ProgressTD = '<td><div class="text-red">Over Limit</div></td>';
                                            break;
                                        case (295):
                                            ProgressTD = '<td><div class="text-green">No Limit</div></td>';
                                            break;
                                        case (progbar):
                                                if (progress > 75 && progress < 90) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color2" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div> <div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }
                                                else if (progress > 90 && progress <= 99) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color3" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div><div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }
                                                else if (true) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div><div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }

                                            break;
                                        default:
                                            ProgressTD = '<td><div class="text-yellow">Not-Assigned</div></td>';
                                            break
                                    }
                                }
                                else {
                                    ProgressTD = '<td><div class="text-green">Pause</div></td>';
                                }
                                //var now = getStatusTime();
                                WOProgressBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Progress[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Progress[i]['CodeID'] + '</td> <td>' + dataJSON.Progress[i]['LocationName'] + '</td><td>' + dataJSON.Progress[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Progress[i]['PriorityColor'] + '">' + dataJSON.Progress[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Progress[i]['AssignToUserName'] + '</td><td>' + dataJSON.Progress[i]['CreatedDate'] + '</td>' + ProgressTD + '</tr>';
                            }
                            WOProgressBody += "</tbody></table>";
                        }
                        $('#divWOProgress').html(WOProgressBody);
                        $("#dtWOProgress").DataTable({
                            "order": [[0, "desc"]]
                        });

                        updateProgressTime();
                        //*******************WO Progress data table End*******************************//



                        $('#dtWOPending').dataTable().fnDestroy();
                        $('#dtWOPending').remove();
                        //*******************WO Pending data table*******************************//
                        var WOPendingBody = '';
                        WOPendingBody = "<table id='dtWOPending' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:17%;'>Location</th><th style='width:18%;'>Project Type</th><th style='width:15%;'>Priority</th><th style='width:20%;'>Assign To</th><th style='width:16%;'>Created On</th></tr></thead><tbody id='dtWOPendingbody'>";
                        if (dataJSON.Pending.length > 0) {
                            for (i = 0; (i < dataJSON.Pending.length) ; i++) {
                                WOPendingBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Pending[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Pending[i]['CodeID'] + '</td> <td>' + dataJSON.Pending[i]['LocationName'] + '</td><td>' + dataJSON.Pending[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Pending[i]['PriorityColor'] + '">' + dataJSON.Pending[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Pending[i]['AssignToUserName'] + '</td><td>' + dataJSON.Pending[i]['CreatedDate'] + '</td></tr>';
                            }
                            WOPendingBody += "</tbody></table>";
                        }
                        $('#divWOPending').html(WOPendingBody);
                        $("#dtWOPending").DataTable({
                            "order": [[0, "desc"]]
                        });
                        //*******************WO Pending data table End*******************************//


                        $('#dtWOComplete').dataTable().fnDestroy();
                        $('#dtWOComplete').remove();
                        //*******************WO Completed data table*******************************//
                        var WOCompleteBody = '';
                        WOCompleteBody = "<table id='dtWOComplete' class='table table-bordered table-striped'><thead><tr><th style='display:none'>Code</th><th style='width:14%'>Code No. </th><th style='width:17%;'>Location</th><th style='width:15%;'>Priority</th><th style='width:20%;'>Completed By</th><th style='width:16%;'>Created On</th><th style='width:18%;'>Completed On</th></tr></thead><tbody id='dtWOCompletebody'>";
                        if (dataJSON.Completed.length > 0) {
                            for (i = 0; (i < dataJSON.Completed.length) ; i++) {
                                WOCompleteBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Completed[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Completed[i]['CodeID'] + '</td> <td>' + dataJSON.Completed[i]['LocationName'] + '</td><td><span class="' + dataJSON.Completed[i]['PriorityColor'] + '">' + dataJSON.Completed[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Completed[i]['AssignToUserName'] + '</td><td>' + dataJSON.Completed[i]['CreatedDate'] + '</td><td>' + dataJSON.Completed[i]['EndTimeFull'] + '</td></tr>';
                            }
                            WOCompleteBody += "</tbody></table>";
                        }
                        $('#divWOComplete').html(WOCompleteBody);
                        $("#dtWOComplete").DataTable({
                            "order": [[0, "desc"]]
                        });
                        //*******************WO Completed data table End*******************************//

                    }
                        //This condition when first time data render.
                    else {
                        //*******************WO Pending data table*******************************//
                        var WOPendingBody = '';
                        $('#divWOPending #dtWOPendingbody').append('');
                        if (dataJSON.Pending.length > 0) {
                            for (i = 0; (i < dataJSON.Pending.length) ; i++) {
                                WOPendingBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Pending[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Pending[i]['CodeID'] + '</td> <td>' + dataJSON.Pending[i]['LocationName'] + '</td><td>' + dataJSON.Pending[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Pending[i]['PriorityColor'] + '">' + dataJSON.Pending[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Pending[i]['AssignToUserName'] + '</td><td>' + dataJSON.Pending[i]['CreatedDate'] + '</td></tr>';
                            }
                        }
                        $('#divWOPending #dtWOPendingbody').html(WOPendingBody);
                        $("#dtWOPending").DataTable({
                            "order": [[0, "desc"]]
                        });
                        //*******************WO Pending data table End*******************************//

                        //*******************WO Completed data table*******************************//
                        var WOCompleteBody = '';
                        $('#divWOComplete #dtWOCompletebody').append('');
                        if (dataJSON.Completed.length > 0) {
                            for (i = 0; (i < dataJSON.Completed.length) ; i++) {
                                WOCompleteBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Completed[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Completed[i]['CodeID'] + '</td> <td>' + dataJSON.Completed[i]['LocationName'] + '</td><td><span class="' + dataJSON.Completed[i]['PriorityColor'] + '">' + dataJSON.Completed[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Completed[i]['AssignToUserName'] + '</td><td>' + dataJSON.Completed[i]['CreatedDate'] + '</td><td>' + dataJSON.Completed[i]['EndTimeFull'] + '</td></tr>';
                            }
                        }
                        $('#divWOComplete #dtWOCompletebody').html(WOCompleteBody);
                        $("#dtWOComplete").DataTable({
                            "order": [[0, "desc"]]
                        });
                        //*******************WO Completed data table End*******************************//
                        
                        //*******************WO Progress data table*******************************//
                        var WOProgressBody = '';
                        $('#divWOProgress #dtWOProgressbody').append('');
                        if (dataJSON.Progress.length > 0) {
                          
                            for (i = 0; (i < dataJSON.Progress.length) ; i++) {
                                var ProgressTD = '';
                                var progress = dataJSON.Progress[i]['ProgressBar'];
                                if (progress != 296 && progress != 295) {
                                    var progbar = progress
                                }
                                if (dataJSON.Progress[i]['PauseStatus'] == 330 || dataJSON.Progress[i]['PauseStatus'] == null) {
                                    switch (parseInt(progress)) {
                                        case (296):
                                            ProgressTD = '<td><div class="text-red">Over Limit</div></td>';
                                            break;
                                        case (295):
                                            ProgressTD = '<td><div class="text-green">No Limit</div></td>';
                                            break;
                                        case (progbar):

                                                if (progress > 75 && progress < 90) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color2" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div> <div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }
                                                else if (progress > 90 && progress <= 99) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar color3" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div> <div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }
                                                else if (true) {
                                                    ProgressTD = '<td class="IsProgress"><div data-perc="' + dataJSON.Progress[i]['ProgressBar'] + '" class="progressbar"><div class="bar" style="width: ' + dataJSON.Progress[i]['ProgressBar'] + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + dataJSON.Progress[i]['ProgressBar'] + '%</div></div></div><div class="timeTill">' + dataJSON.Progress[i]['TimeTill'] + '</div> <div class="starttime" style="display:none">' + dataJSON.Progress[i]['StartTime'] + '</div><div class="endtime" style="display:none">' + dataJSON.Progress[i]['EndTimeTimer'] + '</div></td>';
                                                }

                                            break;
                                        default:
                                            ProgressTD = '<td><div class="text-yellow">Not-Assigned</div></td>';
                                            break
                                    }
                                }
                                else {
                                    ProgressTD = '<td><div class="text-green">Pause</div></td>';
                                }
                                WOProgressBody += '<tr class="odd" role="row"> <td style="display:none">' + dataJSON.Progress[i]['WorkRequestAssignmentID'] + '</td><td class="sorting_1">' + dataJSON.Progress[i]['CodeID'] + '</td> <td>' + dataJSON.Progress[i]['LocationName'] + '</td><td>' + dataJSON.Progress[i]['WorkRequestProjectTypeName'] + '</td><td><span class="' + dataJSON.Progress[i]['PriorityColor'] + '">' + dataJSON.Progress[i]['PriorityLevelName'] + '</span></td><td>' + dataJSON.Progress[i]['AssignToUserName'] + '</td><td>' + dataJSON.Progress[i]['CreatedDate'] + '</td>' + ProgressTD + '</tr>';
                            }
                        }
                        $('#divWOProgress #dtWOProgressbody').html(WOProgressBody);
                        $("#dtWOProgress").DataTable({
                            "order": [[0, "desc"]]
                        });

                        updateProgressTime();
                        //*******************WO Progress data table End*******************************//
                    }
                    //******************* Work Order Pie Chart ***********************************//
                    if (dataJSON.WorkProjectType.length > 0 || dataJSON.WorkStatus.length > 0) {
                        var arrData = [];
                        if (dataJSON.WorkStatus.length > 0) {
                            for (i = 0; i < dataJSON.WorkStatus.length; i++) {
                                arrData.push({
                                    title: dataJSON.WorkStatus[i].Title,
                                    value: parseInt(dataJSON.WorkStatus[i].Value)
                                });
                            }
                        }

                        if (dataJSON.WorkProjectType.length > 0) {
                            for (i = 0; i < dataJSON.WorkProjectType.length; i++) {

                                if (dataJSON.WorkProjectType[i].Title == 'Continuous Request')
                                    dataJSON.WorkProjectType[i].Title = 'CR';
                                if (dataJSON.WorkProjectType[i].Title == 'Facility Request')
                                    dataJSON.WorkProjectType[i].Title = 'FR';
                                if (dataJSON.WorkProjectType[i].Title == 'Special Project')
                                    dataJSON.WorkProjectType[i].Title = 'SP';
                                if (dataJSON.WorkProjectType[i].Title == 'Work Request')
                                    dataJSON.WorkProjectType[i].Title = 'WR';
                                arrData.push({
                                    title: dataJSON.WorkProjectType[i].Title,
                                    value: parseInt(dataJSON.WorkProjectType[i].Value)
                                });
                            }
                        }
                        var chart = AmCharts.makeChart("workOrderChart", {
                            "type": "pie",
                            "theme": "light",
                            "radius": "20%",
                            "innerRadius": "45%",
                            "gradientRatio": [-0.4, -0.4, -0.4, -0.4, -0.4, -0.4, 0, 0.1, 0.2, 0.1, 0, -0.2, -0.5],
                            "dataProvider": arrData,
                            "labelText": "[[title]]",
                            "balloonText": "[[value]]",
                            "valueField": "value",
                            "titleField": "title",
                            "balloon": {
                                "drop": true,
                                "adjustBorderColor": false,
                                "color": "#FFFFFF",
                                "fontSize": 16
                            },
                            "export": {
                                "enabled": true
                            }
                        });
                        var title;
                        var html;
                        // populate our custom legend when chart renders
                        if (chart.dataProvider.length > 0) {
                            $('#legend').html('');
                            html = '<div class="legend-item"><ul>';
                            // populate our custom legend when chart renders
                            // chart.customLegend = document.getElementById('legend');
                            for (var i in chart.dataProvider) {
                                var row = chart.dataProvider[i];
                                if (row.title == 'CR')
                                    title = 'CR-Continuous Request';
                                if (row.title == 'FR')
                                    title = 'FR-Facility Request';
                                if (row.title == 'SP')
                                    title = 'SP-Special Project';
                                if (row.title == 'WR')
                                    title = 'WR-Work Request';
                                if (row.title == 'Complete')
                                    title = 'Complete';
                                if (row.title == 'In Progress')
                                    title = 'In Progress';
                                if (row.title == 'Pending')
                                    title = 'Pending';
                                // var title = row.title;
                                var color = chart.colors[i];
                                var value = row.value;
                                html += '<li><div class="legend-marker" style="background: ' + color + '"></div>' + title + '<span>' + value + '</span></li>';

                            }
                            html += '</ul></div>';
                            $('#legend').append(html);
                        }
                    }
                    else {
                        $('#workOrderChart').html('');
                        $('#legend').html('No Work Order generated for a day');
                    }

                    //******************* Work Order Pie Chart End *******************************//

                    //*******************DAR Marquee*******************************//
                    var DARBody = '';
                    $('#divDarDetails #darDetail').append('');
                    if (dataJSON.DarDetail.length > 0) {
                        for (i = 0; (i < dataJSON.DarDetail.length) ; i++) {
                            DARBody += '<tr><td><div class="zoomin"><img src=' + $_HostPrefix + 'Content/Images/ProfilePic/' + dataJSON.DarDetail[i]['ProfileImage'] + '></div> <div class="dailyActRp"><strong>' + dataJSON.DarDetail[i]['TaskType'] + '</strong><br>' + dataJSON.DarDetail[i]['ActivityDetails'] + '</div></td></tr>';
                        }
                    }
                    $('#divDarDetails #darDetail').html(DARBody);
                    //*******************DAR Marquee End*******************************//

                    //*******************UnAssigned WO Section*******************************//
                    var UnAssignedWOBody = '';
                    $('#divUnAssignedWODetails #UnAssignedDetails').append('');

                    //This condition for client created WO on top of the list
                    if (parseInt(UserType) == parseInt(2) || parseInt(UserType) == parseInt(6)) {
                        if (dataJSON.UnAssignedWOClientCreated.length > 0) {
                            for (i = 0; (i < dataJSON.UnAssignedWOClientCreated.length) ; i++) {
                                UnAssignedWOBody += '<tr id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + ' class="ClientCreatedWO"><td> <strong>' + dataJSON.UnAssignedWOClientCreated[i]['CodeID'] + '</strong><br>' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevelName'] + '<br>' + dataJSON.UnAssignedWOClientCreated[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestProjectTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevelName'] + '</td><td style="display:none;"><img style="height: 150px !important;width: 150px !important;" src=' + $_HostPrefix + 'Content/Images/WorkRequest/' + dataJSON.UnAssignedWOClientCreated[i]['AssignedWorkOrderImage'] + '></td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['WorkRequestStatusName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['CreatedDate'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['CodeID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['LocationName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['LocationID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWOClientCreated[i]['PriorityLevel'] + '</td><td class="vertibalM" align="center"><a class="editBtn assign" id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + '><i class="fa fa-pencil"></i></a> <a class="editBtn view" id=' + dataJSON.UnAssignedWOClientCreated[i]['ID'] + '><i class="fa fa-eye"></i></a></td></tr>';
                            }
                        }
                    }

                    if (dataJSON.UnAssignedWO.length > 0) {
                        for (i = 0; (i < dataJSON.UnAssignedWO.length) ; i++) {
                            UnAssignedWOBody += '<tr id=' + dataJSON.UnAssignedWO[i]['ID'] + '><td> <strong>' + dataJSON.UnAssignedWO[i]['CodeID'] + '</strong><br>' + dataJSON.UnAssignedWO[i]['PriorityLevelName'] + '<br>' + dataJSON.UnAssignedWO[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestProjectTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestTypeName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['PriorityLevelName'] + '</td><td style="display:none;"><img style="height: 150px !important;width: 150px !important;" src=' + $_HostPrefix + 'Content/Images/WorkRequest/' + dataJSON.UnAssignedWO[i]['AssignedWorkOrderImage'] + '></td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['WorkRequestStatusName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['CreatedDate'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['ProblemDesc'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['CodeID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['LocationName'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['LocationID'] + '</td><td style="display:none;">' + dataJSON.UnAssignedWO[i]['PriorityLevel'] + '</td><td class="vertibalM" align="center"><a class="editBtn assign" id=' + dataJSON.UnAssignedWO[i]['ID'] + '><i class="fa fa-pencil"></i></a> <a class="editBtn view" id=' + dataJSON.UnAssignedWO[i]['ID'] + '><i class="fa fa-eye"></i></a></td></tr>';
                        }
                    }


                    $('#divUnAssignedWODetails #UnAssignedDetails').html(UnAssignedWOBody);
                    var dynamicScript = "<script type='text/javascript'>$('#divUnAssignedWODetails #UnAssignedDetails .view').click(function () {  var row = $(this).closest('tr'); var id = $(this).attr('id'); var WorkRequestProjectTypeName = row.find('td').eq(1).html();var WorkRequestTypeName = row.find('td').eq(2).html(); var PriorityLevelName = row.find('td').eq(3).html(); var AssignedWorkOrderImage = row.find('td').eq(4).html(); var WorkRequestStatusName = row.find('td').eq(5).html(); var Submittedon = row.find('td').eq(6).html(); var ProblemDesc = row.find('td').eq(7).html(); var CodeId = row.find('td').eq(8).html(); var LocationName = row.find('td').eq(9).html(); $('#lblProjectType').html(WorkRequestProjectTypeName); $('#lblWorkRequestType').html(WorkRequestTypeName); $('#lblAssignedWorkImage').html(AssignedWorkOrderImage); $('#lblPriorityLevel').html(PriorityLevelName); $('#lblWorkRequestStatus').html(WorkRequestStatusName); $('#lblSubmittedOn').html(Submittedon); if (ProblemDesc == null || ProblemDesc == '') { $('#labellProblemDescription').hide(); $('#lblProblemDescription').hide(); } else { $('#lblProblemDescription').html(ProblemDesc); $('#labellProblemDescription').show(); $('#lblProblemDescription').show(); } $('#lblCodeNo').html(CodeId); $('#lblLocationName').html(LocationName);if(WorkRequestProjectTypeName == 'Special Project'){$('#labelWorkRequestType').hide();$('#lblWorkRequestType').hide()}else{$('#labelWorkRequestType').show();$('#lblWorkRequestType').show()} $('.modal-title').text('Work Order Details'); $('#ModalDetailPreview').modal('show'); }); $('#divUnAssignedWODetails #UnAssignedDetails .assign').click(function () { var row = $(this).closest('tr'); var id = $(this).attr('id'); var ProblemDesc = row.find('td').eq(7).html(); var PriorityLevel = row.find('td').eq(11).html(); var ProjectDesc = row.find('td').eq(7).html(); var locationId = row.find('td').eq(10).html(); var WorkRequestType = row.find('td').eq(1).html(); if (PriorityLevel == null || PriorityLevel == '' || PriorityLevel == 'undefined') { PriorityLevel = 0; } $.ajax({ type: 'GET', data: { 'id': id, 'ProblemDesc': ProblemDesc, 'PriorityLevel': PriorityLevel, 'ProjectDesc': ProjectDesc, 'WorkRequestType': WorkRequestType, 'locationId': locationId }, url: '" + $_HostPrefix + "GlobalAdmin/_AssignWorkAssignmentRequest/', contentType: 'application/json; charset=utf-8', error: function (xhr, status, error) { }, success: function (result) { $('.modal-title').text('Assign Work Order'); $('#largeeditpopup').html(result); $('#myModallarge').modal('show'); } }); });<\/script>";
                    $('#divUnAssignedWODetails').append(dynamicScript);
                    //*******************UnAssigned WO Section End*******************************//

                    //******************* All Active User*******************************//
                    var AllActiveUser = '';
                    $('#divAllActiveUser #AllActiverUser').append('');
                    if (dataJSON.AllActiveUser.length > 0) {
                        for (i = 0; (i < dataJSON.AllActiveUser.length) ; i++) {
                            AllActiveUser += '<tr><td><img src=' + $_HostPrefix + 'Content/Images/ProfilePic/' + dataJSON.AllActiveUser[i]['ProfileImage'] + '><strong>' + dataJSON.AllActiveUser[i]['UserName'] + '</strong><br> <span class="text-green">' + dataJSON.AllActiveUser[i]['UserType'] + '</span></td></tr>';
                        }
                    }
                    $('#divAllActiveUser #AllActiverUser').html(AllActiveUser);
                    //*******************All Active User End*******************************//

                    //******************* WEB Active User*******************************//
                    var WebActiveUser = '';
                    $('#divWebActiveUser #WebActiverUser').append('');
                    if (dataJSON.WebActiveUser.length > 0) {
                        for (i = 0; (i < dataJSON.WebActiveUser.length) ; i++) {
                            WebActiveUser += '<tr><td><img src=' + $_HostPrefix + 'Content/Images/ProfilePic/' + dataJSON.WebActiveUser[i]['ProfileImage'] + '><strong>' + dataJSON.WebActiveUser[i]['UserName'] + '</strong><br> <span class="text-green">' + dataJSON.WebActiveUser[i]['UserType'] + '</span></td></tr>';
                        }
                    }
                    $('#divWebActiveUser #WebActiverUser').html(WebActiveUser);
                    //*******************WEB Active User End*******************************//

                    //******************* MOBILE Active User*******************************//
                    var MobActiveUser = '';
                    $('#divMobActiveUser #MobActiverUser').append('');
                    if (dataJSON.MobActiveUser.length > 0) {
                        for (i = 0; (i < dataJSON.MobActiveUser.length) ; i++) {
                            MobActiveUser += '<tr><td><img src=' + $_HostPrefix + 'Content/Images/ProfilePic/' + dataJSON.MobActiveUser[i]['ProfileImage'] + '><strong>' + dataJSON.MobActiveUser[i]['UserName'] + '</strong><br> <span class="text-green">' + dataJSON.MobActiveUser[i]['UserType'] + '</span></td></tr>';
                        }
                    }
                    $('#divMobActiveUser #MobActiverUser').html(MobActiveUser);
                    //*******************MOBILE Active User End*******************************//
                    var date = new Date();
                    var todaysDate = (date.toLocaleString("en-us", { month: "long" }) + ' ' + date.getDate() + ', ' + date.getFullYear());
                    $('#reservation1').val(todaysDate + ' - ' + todaysDate);
                }
            }).error(function (xhr) {
            });
        } catch (e) {

            console.log('catch', e);
        }
    }

    function getAllWorkOrder() {
        
        // var tbl = $('#messagesTable');
        try {
            $.ajax({
                type: 'GET',
                //url: $_HostPrefix + 'GlobalAdmin/WorkOrderDetailsForPushNotificaitonSignalR',
                url: '@Url.Action("WorkOrderDetailsForPushNotificaitonSignalR", "GlobalAdmin")',
                async: true,
                data: { "id": $("#drp_MasterLocation").val() },
            }).success(function (Data) {
                if (Data.re != null) {
                    if (Data.re.SafetyHazard == 1) {
                        if ($("#pushNotificationForSafetyWorkOrder").is(':visible') == true) {
                            var locid = sessionStorage.getItem("WOLoc");
                            var workRequestId = sessionStorage.getItem("WOWorkRequestAssignmentID");
                            if (parseInt(workRequestId) === parseInt(Data.re.WorkRequestAssignmentID)) {

                            } else if (parseInt(workRequestId) < parseInt(Data.re.WorkRequestAssignmentID)) {
                                if (parseInt(Data.re.LocationID) != parseInt($("#drp_MasterLocation").val())) {
                                    $("#messageForSafetyPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");                                                            
                                }
                                else {
                                    $("#messageForSafetyPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");                                                                      
                                }
                                $("#pushNotificationForSafetyWorkOrder").show();
                            }
                        }
                        else { // visible == false 
                            $("#messageForSafetyPushNotifi").html("");
                            var locid = sessionStorage.getItem("WOLoc");
                            var workRequestId = sessionStorage.getItem("WOWorkRequestAssignmentID");
                            $("#messageForSafetyPushNotifi").empty();
                            if (parseInt(workRequestId) === parseInt(Data.re.WorkRequestAssignmentID)) {

                            } else if (parseInt(workRequestId) < parseInt(Data.re.WorkRequestAssignmentID)) {

                                if (parseInt(Data.re.LocationID) != parseInt($("#drp_MasterLocation").val())) {      
                                    $("#messageForSafetyPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");                                   
                                } else {
                                    $("#messageForSafetyPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");                                   
                                }
                                $("#pushNotificationForSafetyWorkOrder").show();
                            }
                        }
                    }
                    else//IF safety harazard = 0 or null
                    {
                        if ($("#pushNotificationForWorkOrder").is(':visible') == true) {
                            var locid = sessionStorage.getItem("WOLoc");
                            var workRequestId = sessionStorage.getItem("WOWorkRequestAssignmentID");
                            if (parseInt(workRequestId) === parseInt(Data.re.WorkRequestAssignmentID)) {

                            } else if (parseInt(workRequestId) < parseInt(Data.re.WorkRequestAssignmentID)) {
                                if (parseInt(Data.re.LocationID) != parseInt($("#drp_MasterLocation").val())) {
                                    if (Data.re.WorkRequestProjectType == 128) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 129) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Special project '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 256) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New facility request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 279) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Continuous request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                }
                                else {
                                    if (Data.re.WorkRequestProjectType == 128) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 129) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Special project '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 256) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New facility request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 279) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Continuous request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                }
                                $("#pushNotificationForWorkOrder").show();
                            }
                        }
                        else { // visible == false
                            $("#messageForPushNotifi").html("");
                            var locid = sessionStorage.getItem("WOLoc");
                            var workRequestId = sessionStorage.getItem("WOWorkRequestAssignmentID");
                            $("#messageForPushNotifi").empty();
                            if (parseInt(workRequestId) === parseInt(Data.re.WorkRequestAssignmentID)) {

                            } else if (parseInt(workRequestId) < parseInt(Data.re.WorkRequestAssignmentID)) {

                                if (parseInt(Data.re.LocationID) != parseInt($("#drp_MasterLocation").val())) {

                                    if (Data.re.WorkRequestProjectType == 128) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 129) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Special project '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 256) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New facility request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 279) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Continuous request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location.<br /> Kindly change your location if you want to see details.</div>");
                                    }
                                } else {
                                    if (Data.re.WorkRequestProjectType == 128) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New work order '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 129) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Special project '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 256) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>New facility request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                    if (Data.re.WorkRequestProjectType == 279) {
                                        $("#messageForPushNotifi").append("<br><div id='" + Data.re.WorkRequestAssignmentID + "'> <a href='#' class='close' onclick='return closeRightCornerPopUP(this)' id='" + Data.re.WorkRequestAssignmentID + "'>&times;</a>Continuous request '<strong>" + Data.re.WorkOrderCode + Data.re.WorkOrderCodeID + "</strong>' has been generated for '<strong>" + $("#drp_MasterLocation option[value='" + Data.re.LocationID + "']").text() + "</strong>' location. <a href= '" + $_HostPrefix + "GlobalAdmin/WorkAssignmentList'>Click here</a> for more details.</div>");
                                    }
                                }
                                $("#pushNotificationForWorkOrder").show();
                            }
                        }
                    }
                 
                    sessionStorage.clear();
                    if (sessionStorage.length === 0) {
                        sessionStorage.setItem("WOLoc", Data.re.LocationID);
                        sessionStorage.setItem("WOWorkRequestAssignmentID", Data.re.WorkRequestAssignmentID);
                    }
                }
            }).error(function (xhr) {
            });
        } catch (e) {
            console.log('catch', e);
        }
    }

    function getStatusTime(dateVar) {
        var d = new Date(dateVar);
        var datetext = d.toTimeString();
        datetext = datetext.split(' ')[0];
        return datetext;
    }

    function twoDigitForTime(n) {
        return n > 9 ? "" + n : "0" + n;
    }

    function updateProgressTime() {
        var TimerS = 1000;
        TimerS = parseInt(TimerS) + 0;
        var ProgressTD = '';

        setTimeout("updateProgressTime()", 5000); // 5000- 5 seconds 10000 - 10 Sec
        $('#dtWOProgress .progressbar').each(function () {
            
            try {
                //var woDetail = $(this).closest('td').html();
                //var time = $(this).closest('td').find('.timeTill').html();
                //var dateVar = "2016-04-28T" + time;
                //var timer = getStatusTime(dateVar);
                
                var startTime = $(this).closest('td').find('.starttime').html();
                var endTime = $(this).closest('td').find('.endtime').html();
                //var currenttime = new Date();

                //var currenttime = moment().tz("US/Eastern").format('YYYY-MM-DDTHH:mm:ss');//This is for according to client's timezone date
                //var currenttime = moment().tz("Asia/Kolkata").format('YYYY-MM-DDTHH:mm:ss');//This is for according to local machine(India) timezone date
                var currenttime = moment().tz("Etc/GMT").format('YYYY-MM-DDTHH:mm:ss');//This is for according to client's timezone date

                var startdate = new Date(startTime).getTime();//Start Time convert to second
                var currentdate = new Date(currenttime).getTime();//Current Time convert to second
                var enddate = new Date(endTime).getTime();//End Time convert to second

                currentdate = currentdate + TimerS;
                var seconds_Passed = (currentdate - startdate) / 1000;   //How much time passed from start time with current time
                var seconds_left = (enddate - currentdate) / 1000; //How much time away from end time with current time
                var ProgPercent = seconds_Passed / (seconds_Passed + seconds_left) * 100;

                Pdays = parseInt(seconds_Passed / 86400);
                seconds_Passed = seconds_Passed % 86400;

                Phours = parseInt(seconds_Passed / 3600);
                seconds_Passed = seconds_Passed % 3600;

                Pminutes = parseInt(seconds_Passed / 60);
                Pseconds = parseInt(seconds_Passed % 60);

                // do some time calculations
                days = parseInt(seconds_left / 86400);
                seconds_left = seconds_left % 86400;

                hours = parseInt(seconds_left / 3600);
                seconds_left = seconds_left % 3600;

                minutes = parseInt(seconds_left / 60);
                seconds = parseInt(seconds_left % 60);
                //$(this).closest('td').find('.timeTill').html(twoDigitForTime(Phours) + ':' + twoDigitForTime(Pminutes) + ':' + twoDigitForTime(Pseconds));
                if (ProgPercent > 75 && ProgPercent < 90) {
                    ProgressTD = '<div data-perc="' + parseInt(ProgPercent) + '" class="progressbar"><div class="bar color2" style="width: ' + parseInt(ProgPercent) + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + parseInt(ProgPercent) + '%</div></div></div><div class="timeTill">' + twoDigitForTime(Phours) + ':' + twoDigitForTime(Pminutes) + ':' + twoDigitForTime(Pseconds) + '</div> <div class="starttime" style="display:none">' + startTime + '</div><div class="endtime" style="display:none">' + endTime + '</div>';
                }
                else if (ProgPercent > 90 && ProgPercent <= 99) {
                    ProgressTD = '<div data-perc="' + parseInt(ProgPercent) + '" class="progressbar"><div class="bar color3" style="width: ' + parseInt(ProgPercent) + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + parseInt(ProgPercent) + '%</div></div></div><div class="timeTill">' + twoDigitForTime(Phours) + ':' + twoDigitForTime(Pminutes) + ':' + twoDigitForTime(Pseconds) + '</div> <div class="starttime" style="display:none">' + startTime + '</div><div class="endtime" style="display:none">' + endTime + '</div>';
                }
                else if (ProgPercent > 100) {
                    ProgressTD = '<td><div class="text-red">Over Limit</div></td>';
                }
                else if (ProgPercent < 0) {
                    //  ProgressTD = '<td><div class="text-green">Function Limit</div></td>';
                    //Adding this harcode at intitial stage to calculate progress takes 4,5 sec.So upto 4,5 sec we are showing 0:0:0
                    ProgressTD = '<div data-perc="0" class="progressbar"><div class="bar" style="width: 0%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">0%</div></div></div><div class="timeTill">loading..</div> <div class="starttime" style="display:none">' + startTime + '</div><div class="endtime" style="display:none">' + endTime + '</div>';
                }
                else if (true) {
                    ProgressTD = '<div data-perc="' + parseInt(ProgPercent) + '" class="progressbar"><div class="bar" style="width: ' + parseInt(ProgPercent) + '%; overflow: hidden;"><span></span></div><div class="label" style="left: 69px;"><span></span><div class="perc">' + parseInt(ProgPercent) + '%</div></div></div><div class="timeTill">' + twoDigitForTime(Phours) + ':' + twoDigitForTime(Pminutes) + ':' + twoDigitForTime(Pseconds) + '</div> <div class="starttime" style="display:none">' + startTime + '</div><div class="endtime" style="display:none">' + endTime + '</div>';
                }
                $(this).closest('td').html(ProgressTD);
            } catch (e) {
                console.log(e);
            }
        });
    }

    function closeRightCornerPopUP(e) {
        $(e).parent("div").hide();
       
    }
</script>

<style>
    #pushNotificationForWorkOrder {
        display: none;
        height: auto;
        opacity: 20.2;
        /*padding: 18px;*/
        position: fixed;
        right: 0 !important;
        top: 91px !important;
        width: auto;
        z-index: 2147483647 !important;
    }
    #pushNotificationForSafetyWorkOrder {
        display: none;
        height: auto;
        opacity: 20.2;
        /*padding: 18px;*/
        position: fixed;
        /*top: 91px !important;*/
        width: auto;
        z-index: 2147483647 !important;
        bottom: -12px !important;
    }
</style>
